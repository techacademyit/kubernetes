
apiVersion: v1
kind: Service
metadata:
  name: configserver
  namespace: techacademy
  labels:
    app: configserver
spec:
  ports:
  - port: 8080
    name: web
  selector:
    app: configserver
---

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: cfg
  namespace: techacademy
  annotations:
    kubernetes.io/ingress.class: nginx
spec:
  rules:
  - host: "kube.techacademyit.tk"
    http:
      paths:
      - pathType: Prefix
        path: "/config"
        backend:
          service:
            name: configserver
            port:
              number: 8080


---
apiVersion: v1
kind: Secret
metadata: 
  name: github-key
  namespace: techacademy  
type: Opaque
data:
  rsa_key.pub: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlKS1FJQkFBS0NBZ0VBc24rV3Y0THlmVnpYY2JTNURBbGFoNGdPclZaNzB0NGNyc3NHalYxL1JTQjFVcTZNCk52UzFCYnFhVituMldoVkJDekQ0WUxQck8vYWNZSFpSWnN1Znhac2JKckIzMkR1UHJubWtqRlI3QkhXdTZwcmUKb0thWEl4eUFZdXFOdXhNbW9CL3FGZzEreFk5WmI0VEdDeW12WnJRKyt5ZnJkZnREenJ0dFNtQXR0UnorVGxJUQprRnNFWGlvNlhVamtHdGgvTitXQ3Q2Vnk2a21UN0RVMWhqZSsyQ2trNzdMYko3TitxMnBaVkYrYlNvN0F6U3dJCkVxVldRdXgwTkVRdVZTUUJwaWMvb1N3S0tZZmV6ZXI5eXpWNkJhdnFXeFU0YU5hcVdJUktvSjdnbDc3aktyZSsKWXRhNVlhV3RWOStEN1ppSTRDOVdUcm5mZllOcWFRRDZBaXdwYVhvK0VxMDJDRy9mZk1YN2dNdEFwQ1FybTlVRQordGhmZ2VxVUwzTEx2TkJCY2ZIdk1za21oVVBWcE1sVittd2IzT1IvWkFZaENFQ3JyL3ZxZ3NyS01pVnk3aGdDCnlrWWNUQ2JFM0RMcHZacWdIQnNKNWwzSktVaDV1elQ3d2oxU2JBMTRjRzVMMlhOUXVESm00Qktpb1pSQ1ZwcEkKWHBYZ041ejhiUVpXY1E4NEVxcG9iemd6dHd2THQyUjZodjhTdmMzYWRGSFBKTmF2RTkwdkRETGhYSjdEU0F6agpTQmlkdHNEWitObWh6UnYrT2dsTHJ4Qi9hNXZvM05rYktJdUFUY0dqUFlDeFlhWloya0RTdGQ5RERBQnRhZGFsCkpwcWl3OHVSY3MwV200K0M5TDJHbktDZndFemdHSXJVbkdVbXhhVG4vTlhOU3ZBSWV2N2E1dXNCazRVQ0F3RUEKQVFLQ0FnQUowa2RqSmp0ZGRueE1QMXRuTkNTTkRJbHlOQzMvL2tTcHdYWU0xVFlwZ1kyekRQT2VHbnpUWWQ4WQpNMEZnMTRhS3JSa2RpUWpLZGRsSTNYbkJKRGNZVWw1K0ZIdWpwRE5Wc0UvRGdPcDc1bFhIaHRuMUVQV0Q4dytGClljNkdtcGtuZWxvUStKRWZJYklVRnNRbTNSWlBtbDlVeG0rSVFGa015UGRNZmxwRmV1RHJRa3l6Qks4SzExdjYKd2dYN0RDcUQwdGNNYjhnUTZCZUJpYlAyUEo3OW1kWDBjbXpvbEZIRjhNWVZoR1V4QndYSXhFRjFkUzkzNHpiSgpvVzdETklYNnRISWwxaHlCQ0g3VDZiZ3BORG9Ra2RNRlMvZWNuU01tVjdFYmdXSnVOd3ljenh0a3FOZnViWVZLCkxudzkySVMvZ1J0SW5hV1ViR1N3Zm1ORE4xYlg1VjBDaEQzUHBjVC93VjNrdEpMWVNkN2VKcXBobEw5WG9DTHYKSGxWSkp6d20rZXpuZXlPL1RRd2xBQkFiL21GQ1Z0SjdrYWZCa3h3Y3R5eHlBTmlBQmdNak1HQ0JFRElMeDN3OQpPcHQzRG8vU0R6NmlBZzhkNDJ3blZvRUhlK003S29EdERJcGFTWDIrSXRkTnZPTXVFbXVTZk8xdDliYWYrMVpKCjYxL1ZEZUMrVWw3bkFBSXdTdmlEWWI4NFlWNnEwRkdxUmtXd3dlLzBqZCtnZHk0QXRwYUdaQWRhR1VwUXc1MW8KS3hRa2FzMlZsNm40M1crRmYrMXl6L2pzN2tnN3QycFQvM3JlaW96MFIyZWNsY2l1M3piTStWVFNXZVhuZUZmUwpOcUJaandhZWx2eU1TSm5RRWxyd1lnN0NTMHMyV3ErZmo5SVVwZ0JxMy9PUkFwaVRnUUtDQVFFQTNuNzJtbnZKCjAvQlB2YU4ybDFqWVlXK04yb2w1ZjN4WHgxNGhkRnBqdmFFZHF0dktzN1hxbVh4eXhUcFBGcGxyMEpnUXlXNlAKcGR0ZU9iNW11WmZhc01tZ0s2SHA2QWtoOWMvZzVDR2gyZUZuU09UNlFsTjVnZXo5YWdORlM1azJ2bHRxZzB4bQp3SFR3NTRLVERGN2pzZUpFTTg5bVJGSXBBUHdrUVFqMUFiN2hCVDljbDNDTDRIRGhJdDNXNWpQTmZXZGl6YzNhCkVBOThxcmhoVm1IY0hSVFN3ZVpwVUVlMVVuMnkwL0pKRHdPVlZicW9DaElrbXg0QW9UV1liQUsxZ0l1cmxjUTMKWkJLbzUzd2s2VzJtSVFML3ZzVWRiZDRKV2lkUEF2cHdFU2c2NThaelJobkVkd1d3SlVOaloyNE1jUWhzaEw1YQpYVE0rbWZLSkFmQ3drUUtDQVFFQXpXQ09TRi96R2tGclZwcFhqVDhPVFJhanptM2JiWTA4b2Zic2lZOVg1bUJICldmZm5UTG9mRk9DQkZsaHZZYUdnb3h2VkFJc054U1hPblZETTQ3bTc4ZlBDOURXY1RvVUovbWltTXNMZytBNloKb0VJVkY0dlhFVHN3QzJmeWxjN2JjM1NFbTJMcjBzMmJQRTZiWXc3YTRMSmI2ZENuY3BpVjdLRTA2cW1hVU81UgpYdTdDNk02QmptZE9mK2FuUUkxdERMQTQyWi8xZUE0RlA0TnNDK05UVUM2K1lFM0xBRCsxd2ZwUm9XdjNhdmt5CkI4dDg2a2xKNGNXeU8xS3ZqdDNjYnFxUkZGTWI5YVJHdzJpOXVva2E2V0MrL2NPcFNKUmJKelRiRDZTYTJzWTgKZlZyVjdUQUk0dGdWYUFxOHYvNHQ3QWU2WWtPVlJXQUpISGExeWJkdHRRS0NBUUFyUjI4WXBiT2dza0lRbFZkZwpJVHdWMStrejlVSFk5b3Jza1BiWTl5d25tc3Qyak1KbEtxR3pzVzF4eCtIU2Q0MXRTZWNhQjVPUm81WTBqVURXCklSKzgrN3RZUVdxS1pCeGpBRWl5bDRnd0paUTlyYXl3Y2lSVWpaRE5xazAwWTEwdXNnR0tBTGFNQVROTEZTOGQKWE9mVmxqbkdDalhPWEZ6MWdCWmRRQ3pJWmlUSExJZ0tQUzQ0UGp6TTEzSVIzVW0vZHZqVko1R2ZSaVB0NFdldApzZU5yRkwzYVVjTnloa0JUQjNoZG1lZDBNREpBTnNxeENzNXNEZTM1YmI5MFl5S0RHcWdKdmQwNGJoakV6blV2Cm90Q0o0MWR6K0V1OUwwK0taZE1NdFVKUFZCQUJQYXoybWRTSmdtVzlHZHFnSjl2cnNNUExIbXZkYlRaa0k3VmEKMTBMQkFvSUJBUUN5cWozOUhtT0pRc0lUTy8vUVk3dVlPb3JVU1dPcndVT3ZEdldsa2VzQkFsN3dHS2JDYStRZwpNRko4VXdES2FXWXFuMHJFeHpONmY3Sm56dVAvZEJQWm41ckpBbDV4UEhGK1BpSGZaUU43S0pCakJ6bjhHdTVGCkVqMXduc1E5cVEvbU44WW91M3kyRGFIdmE5N241UU5xbUI4M29Bb2J1andxOSs3bCtoZkNNaURkdWs0Ylk1TDMKaEUyWkhOb0JZVWN0MDV3UlRvT29KbUpRWjQ4MkpGUFZIR1VIdUlWU09ScHduc2dtNnByNkY4RjdZSDNSLzJIagpwQzJ5Ui9Oc0VQdnoxalNSL3Q4QzZoK1pYV1E0ZzQvQzJTUXQ5T291dHNrNXFWU3RIaUNORkFtSmI5MU5FdzJYCjhpMWxMbm9YZUJNUkU0UUVlaERBb3BRcWkrY0hqYWhGQW9JQkFRRGR5UlRPSVpPcy91STMycEFnQ2hmeFB4M3gKUUJGWngvYkhGcjk3SXZ2RC9CdUJ6WE1lVWU5cWdmYWtRYjFmOW56L3ZpMG1BN2hUdzg0Q2kvUFJzaWE5NERKRwpzbEdMV0llc0xucTNWcjVITGRWNFArL0E0WHcxZVZzbnU5UnZaaW9kY20yOFpUb0huNmRGL3V5MGlMUDVHRElFClNrVStYZmd1c28wRGRseWx3UGltWXJVTE96TmRFMjJTZjRBV1FHS20xTVhPQ1VkRnJaRE4vRHVhOTBqeVpGengKNFBmaHZrQUNWd2pXMG1jd0tyRkk0OStYdFdEdVltUGlmYURWNXIybUdSa1Q3d0dIcXByaE8yQkpHNkptMHZvTQpkSU45U2t6Zk4xOGxyaW5ZZ1ZhcVU5QVE1Y3JUMFhWRDdXWDQwUnh5SnRLaVljVjl1Tll6MUFiUzVGNHMKLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0K

---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: configserver
  name: configserver
  namespace: techacademy 
spec:
  replicas: 1
  selector:
    matchLabels:
      app: configserver
  template:
    metadata:
      labels:
        app: configserver
    spec:
      containers:
      - name: nginx
        image: registry.digitalocean.com/techacademyregistry01/cfg-server:latest
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
          protocol: TCP
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /actuator/health
            port: 8080
            scheme: HTTP
        
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /actuator/health
            port: 8080
            scheme: HTTP
        env:
        - name: PORT
          value: "8080"
        - name: PRIVATE_KEY
          valueFrom:
            secretKeyRef:
              key: rsa_key.pub
              name: github-key

        
